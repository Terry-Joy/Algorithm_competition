首先由于 \(k\) 很大，所以我们没有办法直接求出第 \(k\) 个值，所以我们考虑二分答案，检验它是不是第 \(k\) 个

那么我们考虑如何 \(check\) ,首先方案选择分为两种情况，为了方便起见，我们令 $(c_i=c_i-a_i,b_i=b_i-a_i)$ ，这样 \(a\) 相当于是必选的，然后我们维护三个序列的前缀和

1. 两个区间不相交

   $[sum=b_{x+r-1}-b_{x-1}+b_{y+r-1}-b_{y-1} \\ =(b_{x+r-1}-b_{x-1})+(b_{y+r-1}-b_{y-1}) \\ =g(x)+g(y) ]$

   我们枚举 \(y\) 查询一下 $([1,y-r])$ 中满足$ (g(y)+g(x)\le mid) $的 \(x\) 个数，二维数点问题直接树状数组

2. 两个区间相交

   $[sum=b_{y-1}-b_{x-1}+c_{x+r-1}-c_{y-1}+b_{y+r-1}-b_{x+r-1} \\ =(c_{x+r-1}-b_{x-1}-b_{x+r-1})+(b_{y-1}-c_{y-1}+b_{y+r-1})  =f(x)+h(y) ]$

   我们枚举 \(y\) 查询一下，$([y-r+1,y-1]) $中满足 $(h(y)+f(x)\le mid)$ 的 \(x\) 的个数 , 二维数点问题直接树状数组

